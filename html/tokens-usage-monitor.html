<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tokensä½¿ç”¨é‡ç›‘æ§</title>
    <!-- å¼•å…¥ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #1a1a1a;
            color: #ffffff;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #2d2d2d;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #ffffff;
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
            font-weight: bold;
        }
        
        #chart-container {
            width: 100%;
            height: 500px;
            margin-bottom: 30px;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 30px;
            padding: 20px;
            background-color: #404040;
            border-radius: 8px;
            border: 1px solid #555;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .stat-label {
            color: #cccccc;
            margin-top: 5px;
            font-size: 14px;
        }
        
        .back-button {
            display: inline-block;
            margin-bottom: 20px;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        
        .back-button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/api/admin" class="back-button">â† è¿”å›åå°å¯¼èˆª</a>
        <h1>ğŸ“Š Tokensä½¿ç”¨é‡ç›‘æ§</h1>
        
        <div id="chart-container"></div>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="total-tokens">0</div>
                <div class="stat-label">æ€»ä½¿ç”¨é‡ (k)</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="avg-tokens">0</div>
                <div class="stat-label">æ—¥å‡ä½¿ç”¨é‡ (k)</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="max-tokens">0</div>
                <div class="stat-label">å³°å€¼ä½¿ç”¨é‡ (k)</div>
            </div>
        </div>
    </div>
    
    <script>
        // åˆå§‹åŒ–å›¾è¡¨
        const chart = echarts.init(document.getElementById('chart-container'));
        
        // è·å–ä½¿ç”¨é‡æ•°æ®
        async function getUsageData() {
            const response = await fetch('/api/tokens-usage');
            return await response.json();
        }
        
        // æ›´æ–°å›¾è¡¨å’Œç»Ÿè®¡ä¿¡æ¯
        async function updateChart() {
            const usageData = await getUsageData();
            
            // è®¡ç®—ç»Ÿè®¡æ•°æ®
            const totalTokens = usageData.reduce(function(sum, item) { return sum + item[1]; }, 0).toFixed(2);
            const avgTokens = (totalTokens / usageData.length).toFixed(2);
            const maxTokens = Math.max.apply(null, usageData.map(function(item) { return item[1]; })).toFixed(2);
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            document.getElementById('total-tokens').textContent = totalTokens;
            document.getElementById('avg-tokens').textContent = avgTokens;
            document.getElementById('max-tokens').textContent = maxTokens;
            
            // é…ç½®å›¾è¡¨é€‰é¡¹
            const option = {
                backgroundColor: '#2d2d2d',
                title: {
                    text: 'æ¯æ—¥Tokensä½¿ç”¨é‡è¶‹åŠ¿',
                    left: 'center',
                    textStyle: {
                        color: '#ffffff',
                        fontSize: 18
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: function(params) {
                        const date = params[0].name;
                        const tokens = params[0].value;
                        return date + '<br/>Tokensä½¿ç”¨é‡: ' + tokens + ' k';
                    },
                    backgroundColor: 'rgba(64, 64, 64, 0.9)',
                    borderColor: '#555',
                    textStyle: {
                        color: '#ffffff'
                    }
                },
                xAxis: {
                    type: 'category',
                    data: usageData.map(function(item) { return item[0]; }),
                    axisLabel: {
                        rotate: 45,
                        interval: 2,
                        color: '#cccccc',
                        fontSize: 12
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#555'
                        }
                    },
                    axisTick: {
                        lineStyle: {
                            color: '#555'
                        }
                    }
                },
                yAxis: {
                    type: 'value',
                    name: 'Tokensä½¿ç”¨é‡ (k)',
                    nameTextStyle: {
                        color: '#cccccc',
                        fontSize: 14
                    },
                    axisLabel: {
                        formatter: '{value} k',
                        color: '#cccccc',
                        fontSize: 12
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#555'
                        }
                    },
                    axisTick: {
                        lineStyle: {
                            color: '#555'
                        }
                    },
                    splitLine: {
                        lineStyle: {
                            color: '#404040'
                        }
                    }
                },
                series: [{
                    data: usageData.map(function(item) { return +item[1].toFixed(2); }),
                    type: 'line',
                    smooth: true,
                    symbol: 'circle',
                    symbolSize: 8,
                    lineStyle: {
                        width: 3,
                        color: '#4CAF50'
                    },
                    itemStyle: {
                        color: '#4CAF50'
                    },
                    areaStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: 'rgba(76, 175, 80, 0.3)' },
                            { offset: 1, color: 'rgba(76, 175, 80, 0.05)' }
                        ])
                    }
                }]
            };
            
            // è®¾ç½®å›¾è¡¨é€‰é¡¹
            chart.setOption(option);
        }
        
        // åˆå§‹æ›´æ–°
        updateChart();
        
        // å“åº”å¼å¤„ç†
        window.addEventListener('resize', function() {
            chart.resize();
        });
        
        // å®šæ—¶æ›´æ–°
        setInterval(updateChart, 5000);
    </script>
</body>
</html>